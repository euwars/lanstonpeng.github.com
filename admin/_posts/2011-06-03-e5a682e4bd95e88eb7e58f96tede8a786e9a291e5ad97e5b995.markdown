---
author: lanstonpeng
comments: true
date: 2011-06-03 09:43:08+00:00
layout: post
slug: '%e5%a6%82%e4%bd%95%e8%8e%b7%e5%8f%96ted%e8%a7%86%e9%a2%91%e5%ad%97%e5%b9%95'
title: 如何获取Ted视频字幕
wordpress_id: 540
categories:
- 未分类
tag:
- idea
- python
- Ted
---

官网提供视频下载但不给字幕，搜索了一下有些软件可以用，也有一个[GAE上面的网站](http://tedtalksubtitledownload.appspot.com)帮我们干， 但是伟大的GFW......
于是就自己捣鼓起来了：

分析了ted上面的页面信息，发现有这么一段代码：

`function getTranscript(language) {
var transcriptCallback = {success: onGetTranscriptSuccess, failure: onGetTranscriptFailure, scope: this};
var req = YAHOO.util.Connect.asyncRequest('GET', YAHOO.Tools.printf('/talks/subtitles/id/{0}/lang/{1}/format/html',talkID,language), transcriptCallback, null);
showLoadAnimation();
}`

这个是字幕的json数据包，去[wiki](http://zh.wikipedia.org/wiki/%E5%AD%97%E5%B9%95%E6%A0%BC%E5%BC%8F#SRT.E6.A0.BC.E5.BC.8F)了一下srt格式的字幕规范，譬如在srt有这样的一段

194
00:08:33,330 --> 00:08:36,330
我们需要它向我们介绍新想法、

194代表是第几个字幕，
8分33.330到8分36.330出现这句话

整个流程的思路不难
<!-- more -->
**1。html --> 2。json --> 3。sct**

其中，在获取json地址的时候要获取到这个talk的id与language
现给出1，2步骤的代码
`
import urllib2,StringIO,json,re`

`def getHtml(url):
html=urllib2.urlopen(url).read()
return html`

`def jsonToDict(text):
return json.load(StringIO.StringIO(text))`

`def getTalkId(html):
m=re.search('(?<=var talkID = )\w+',html)
talkid=m.group(0)
return talkid

#  Maybe Most of us think these languages are recognizable
#  chi_hans         Chinese (Simplified)
#  chi_hant         Chinese (Traditional)
#  eng              English

def getJson(talkid,lanType):
template="http://www.ted.com/talks/subtitles/id/{0}/lang/{1}/format/text"
jsonUrl=template.format(talkid,lanType)
text=urllib2.urlopen(jsonUrl).read()
return jsonToDict(text)

`
代码不多且简单

对于json到srt格式的转化可以观察到：

在json一个小段落中有
{"content":"Actually, I think it'll eventually","startTime":4000,"duration":2000,"startOfParagraph":false}

需要做的只是一个映射而已，思路大概是这样：
`
def jsonToSrt(myjson):
arr=myjson["captions"]
count=1
length=len(arr)
hour="00:"
for i in range(1,length+1):
print count
m,s,ms=getTheTime(arr[i]['starTime'])
print hour+m+":"+s+","+ms+" -->  "
m,s,ms=getTheTime(arr[i]['startTime']+arr[i]['duration'])
print hour+m+":"+s+","+ms
print arr[i]["content"]
print "\n"`

`def getTheTime(time):
minute=int((int(time / 1000) % 3600) / 60 )
second = int(time/ 1000) -minute * 60;
msecond = time - (minute * 60 + second) * 1000;
return minute,second,msecond

`
